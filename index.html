<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Link Manager Cloud</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e1e2e">

    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        
        // Configuration from your image
        const firebaseConfig = {
            apiKey: "AIzaSyCSneZofrBGOwHDLNK2f2SDUiiwnoah2cM",
            authDomain: "personal-54ee0.firebaseapp.com",
            databaseURL: "https://personal-54ee0-default-rtdb.firebaseio.com",
            projectId: "personal-54ee0",
            storageBucket: "personal-54ee0.firebasestorage.app",
            messagingSenderId: "478812450198",
            appId: "1:478812450198:web:483b14772d4b2b5f5301b7"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        
        // Expose to window for the main app logic
        window.firebaseModules = { db, auth, ref, push, onValue, remove, update, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut };
    </script>

    <style>
        :root {
            --bg-body: #f2f4f7;
            --bg-surface: #ffffff;
            --text-main: #111;
            --text-sec: #666;
            --primary: #0088cc;
            --danger: #e53935;
            --border: #e0e0e0;
            --shadow: 0 1px 3px rgba(0,0,0,0.05);
            --radius: 8px;
            --sp-xs: 4px; --sp-sm: 8px; --sp-md: 12px;
            --bar-h: 56px;
        }

        [data-theme="dark"] {
            --bg-body: #121212;
            --bg-surface: #1e1e1e;
            --text-main: #eee;
            --text-sec: #aaa;
            --border: #333;
            --shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        [data-theme="amoled"] {
            --bg-body: #000;
            --bg-surface: #000;
            --text-main: #fff;
            --text-sec: #888;
            --border: #222;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { background: var(--bg-body); color: var(--text-main); height: 100vh; display: flex; overflow: hidden; font-size: 14px; }

        /* --- Layout --- */
        .app-shell { display: flex; width: 100%; height: 100%; position: relative; }

        .sidebar-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6); z-index: 99;
            opacity: 0; pointer-events: none; transition: 0.3s;
            backdrop-filter: blur(2px);
        }
        .sidebar-overlay.active { opacity: 1; pointer-events: auto; }

        .sidebar {
            width: 250px; background: var(--bg-surface); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; z-index: 100;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .brand { height: var(--bar-h); display: flex; align-items: center; padding: 0 var(--sp-md); font-weight: 700; font-size: 16px; border-bottom: 1px solid var(--border); gap: 10px; color: var(--primary); }
        
        .nav-list { padding: var(--sp-sm); flex: 1; overflow-y: auto; }
        .nav-item {
            padding: 8px 12px; border-radius: var(--radius); cursor: pointer;
            display: flex; align-items: center; gap: 10px; color: var(--text-sec);
            margin-bottom: 2px; font-weight: 500;
        }
        .nav-item.active, .nav-item:hover { background: rgba(0,136,204,0.1); color: var(--primary); }
        .nav-item i { width: 20px; text-align: center; }

        /* Main Area */
        .main { flex: 1; display: flex; flex-direction: column; position: relative; width: 100%; }
        
        .top-bar {
            height: var(--bar-h); background: var(--bg-surface); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; padding: 0 var(--sp-sm); gap: var(--sp-sm);
            flex-shrink: 0;
        }

        .icon-btn {
            width: 40px; height: 40px; border-radius: 50%; border: none; background: transparent;
            color: var(--text-sec); display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 18px; flex-shrink: 0;
        }
        .icon-btn:hover { background: rgba(0,0,0,0.05); color: var(--text-main); }
        .icon-btn.active-state { color: var(--bg-surface); background: var(--primary); }

        .search-wrap { flex: 1; display: flex; align-items: center; background: var(--bg-body); border-radius: 20px; padding: 0 12px; height: 36px; border: 1px solid var(--border); }
        .search-wrap input { border: none; background: transparent; width: 100%; outline: none; color: var(--text-main); margin-left: 8px; font-size: 14px; }

        /* Mode Bar */
        .mode-bar {
            display: flex; gap: 8px; padding: 8px 12px; 
            border-bottom: 1px solid var(--border); 
            background: var(--bg-surface); 
            overflow-x: auto; white-space: nowrap;
            scrollbar-width: none; flex-shrink: 0;
        }
        .mode-btn {
            padding: 6px 16px; border-radius: 20px; 
            border: 1px solid var(--border); 
            background: var(--bg-body); color: var(--text-sec);
            font-size: 13px; font-weight: 600; cursor: pointer; transition: 0.2s;
        }
        .mode-btn.active {
            background: var(--text-main); color: var(--bg-surface); 
            border-color: var(--text-main);
        }

        /* Grid Content */
        .content-area { flex: 1; overflow-y: auto; padding: var(--sp-sm); }
        
        .grid {
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(100%, 1fr)); 
            gap: var(--sp-sm);
        }
        @media (min-width: 600px) { .grid { grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); } }
        @media (min-width: 1000px) { .grid { grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); } }

        .card {
            background: var(--bg-surface); border: 1px solid var(--border);
            border-radius: var(--radius); padding: 8px;
            display: flex; align-items: center; gap: 10px;
            position: relative; transition: 0.1s;
            height: 60px;
        }
        .card:active { transform: scale(0.99); background: var(--bg-body); }

        .c-icon {
            width: 42px; height: 42px; border-radius: 8px; flex-shrink: 0;
            display: flex; align-items: center; justify-content: center; font-size: 20px;
        }
        .c-icon.has-img {
            padding: 0; background: transparent; overflow: hidden; border: 1px solid var(--border);
        }
        .c-icon img {
            width: 100%; height: 100%; object-fit: cover;
        }

        .tg { background: rgba(0,136,204,0.1); color: #0088cc; }
        .wa { background: rgba(37,211,102,0.1); color: #25d366; }
        .fb { background: rgba(24,119,242,0.1); color: #1877f2; }
        .def { background: rgba(128,128,128,0.1); color: #666; }

        .c-info { flex: 1; overflow: hidden; display: flex; flex-direction: column; justify-content: center; }
        .c-title { font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 14px; line-height: 1.2; }
        .c-sub { font-size: 11px; color: var(--text-sec); display: flex; gap: 6px; margin-top: 2px; }
        .c-badge { background: var(--bg-body); padding: 0 4px; border-radius: 4px; border: 1px solid var(--border); text-transform: uppercase; font-size: 9px; }

        .c-actions { display: flex; gap: 6px; align-items: center; }
        
        .btn-open {
            background: var(--bg-body); color: var(--primary); 
            padding: 6px 14px; border-radius: 16px; font-weight: 600; 
            font-size: 12px; text-decoration: none; border: 1px solid var(--border);
            display: flex; align-items: center; gap: 4px;
        }
        .btn-action {
            width: 32px; height: 32px; border-radius: 50%; display: flex; 
            align-items: center; justify-content: center; border: 1px solid var(--border);
            background: var(--bg-body); color: var(--text-sec); cursor: pointer;
        }
        .btn-del { color: var(--danger); border-color: rgba(229,57,53,0.2); }

        body:not(.edit-mode) .action-edit { display: none; }
        body.edit-mode .action-open { display: none; }

        .fab {
            position: absolute; bottom: 20px; right: 20px;
            width: 50px; height: 50px; border-radius: 14px;
            background: var(--primary); color: #fff; border: none;
            box-shadow: 0 4px 10px rgba(0,136,204,0.4);
            font-size: 20px; cursor: pointer; display: flex;
            align-items: center; justify-content: center; z-index: 50;
        }

        @media (max-width: 768px) {
            .sidebar { position: fixed; top: 0; bottom: 0; left: 0; transform: translateX(-100%); }
            .sidebar.show { transform: translateX(0); }
            .menu-btn { display: flex; }
        }
        @media (min-width: 769px) {
            .menu-btn { display: none; }
            .sidebar-overlay { display: none !important; }
        }

        .modal-wrap {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 200;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: 0.2s; backdrop-filter: blur(3px);
        }
        .modal-wrap.active { opacity: 1; pointer-events: auto; }
        .modal { background: var(--bg-surface); width: 90%; max-width: 380px; padding: 20px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        
        .inp-group { margin-bottom: 12px; }
        .inp-label { font-size: 11px; color: var(--text-sec); margin-bottom: 4px; display: block; font-weight: 600; text-transform: uppercase; }
        .inp { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-body); color: var(--text-main); font-size: 14px; outline: none; }
        .inp:focus { border-color: var(--primary); }
        
        .btn-full { width: 100%; padding: 12px; background: var(--primary); color: #fff; border: none; border-radius: 8px; font-weight: 600; font-size: 14px; margin-top: 8px; }
        
    </style>
</head>
<body data-theme="light">

    <div class="app-shell">
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="app.toggleSidebar(false)"></div>

        <nav class="sidebar" id="sidebar">
            <div class="brand">
                <i class="fa-solid fa-cloud"></i> LinkCloud
            </div>
            <div class="nav-list">
                <div class="nav-item active" onclick="app.filter('all', this)"><i class="fa-solid fa-layer-group"></i> All Links</div>
                <div class="nav-item" onclick="app.filter('telegram', this)"><i class="fa-brands fa-telegram"></i> Telegram</div>
                <div class="nav-item" onclick="app.filter('whatsapp', this)"><i class="fa-brands fa-whatsapp"></i> WhatsApp</div>
                <div class="nav-item" onclick="app.filter('facebook', this)"><i class="fa-brands fa-facebook"></i> Facebook</div>
                <div style="height: 10px; border-bottom: 1px solid var(--border); margin: 5px 0;"></div>
                <div class="nav-item" onclick="app.openSettings()"><i class="fa-solid fa-sliders"></i> Settings</div>
                
                <div class="nav-item" id="authBtn" onclick="app.openAuthModal()">
                    <i class="fa-solid fa-right-to-bracket"></i> <span>Login</span>
                </div>
            </div>
        </nav>

        <main class="main">
            <header class="top-bar">
                <button class="icon-btn menu-btn" onclick="app.toggleSidebar(true)">
                    <i class="fa-solid fa-bars"></i>
                </button>
                
                <div class="search-wrap">
                    <i class="fa-solid fa-search" style="color:var(--text-sec)"></i>
                    <input type="text" placeholder="Search..." oninput="app.search(this.value)">
                </div>

                <button class="icon-btn" id="editToggleBtn" onclick="app.toggleEditMode()" title="Toggle Edit/Delete">
                    <i class="fa-solid fa-pen-to-square"></i>
                </button>
            </header>

            <div class="mode-bar">
                <button class="mode-btn active" onclick="app.setMode('all', this)">All</button>
                <button class="mode-btn" onclick="app.setMode('group', this)">Groups</button>
                <button class="mode-btn" onclick="app.setMode('website', this)">Websites</button>
                <button class="mode-btn" onclick="app.setMode('video', this)">Videos</button>
            </div>

            <div class="content-area">
                <div class="grid" id="grid"></div>
            </div>

            <button class="fab" onclick="app.openModal()"><i class="fa-solid fa-plus"></i></button>
        </main>
    </div>

    <div class="modal-wrap" id="authModal">
        <div class="modal">
            <h3 style="margin-bottom:15px">Account Access</h3>
            
            <div class="inp-group">
                <label class="inp-label">Email</label>
                <input type="email" class="inp" id="authEmail" placeholder="your@email.com">
            </div>
            
            <div class="inp-group">
                <label class="inp-label">Password</label>
                <input type="password" class="inp" id="authPass" placeholder="******">
            </div>

            <button class="btn-full" onclick="app.handleAuth('login')">Login</button>
            <button class="btn-full" style="background:#4caf50; margin-top:8px" onclick="app.handleAuth('register')">Register New Account</button>
            <button class="btn-full" style="background:transparent; color:var(--text-sec); border:1px solid var(--border); margin-top:8px" onclick="document.getElementById('authModal').classList.remove('active')">Cancel</button>
        </div>
    </div>

    <div class="modal-wrap" id="modal">
        <div class="modal">
            <h3 style="margin-bottom:15px">Save Link</h3>
            <input type="hidden" id="editId">
            
            <div class="inp-group">
                <label class="inp-label">Title</label>
                <input type="text" class="inp" id="inpTitle" placeholder="Group Name or Title">
            </div>
            
            <div class="inp-group">
                <label class="inp-label">Link URL</label>
                <input type="url" class="inp" id="inpUrl" placeholder="https://t.me/...">
            </div>

            <div class="inp-group">
                <label class="inp-label">Category</label>
                <input type="text" class="inp" id="inpCat" placeholder="Work, Family, Study...">
            </div>

            <div class="inp-group" style="display:flex; gap:10px;">
                <div style="flex:1">
                    <label class="inp-label">Type</label>
                    <select class="inp" id="inpType">
                        <option value="group">Group</option>
                        <option value="website">Website</option>
                        <option value="video">Video</option>
                    </select>
                </div>
                <div style="flex:1">
                    <label class="inp-label">Image URL (Opt)</label>
                    <input type="text" class="inp" id="inpImg" placeholder="Paste Img Link">
                </div>
            </div>

            <button class="btn-full" onclick="app.save()">Save</button>
            <button class="btn-full" style="background:transparent; color:var(--text-sec); border:1px solid var(--border); margin-top:8px" onclick="app.closeModal()">Cancel</button>
        </div>
    </div>

    <div class="modal-wrap" id="settings">
        <div class="modal">
            <h3 style="margin-bottom:15px">Settings</h3>
            
            <div class="inp-group">
                <label class="inp-label">Appearance</label>
                <select class="inp" onchange="app.setTheme(this.value)" id="themeSelect">
                    <option value="light">Light (Clean)</option>
                    <option value="dark">Dark (Night)</option>
                    <option value="amoled">AMOLED (Black)</option>
                </select>
            </div>

            <div class="inp-group">
                <label class="inp-label">Info</label>
                <div style="font-size:12px; color:var(--text-sec)">
                    Data is now synced securely with Firebase Cloud.
                </div>
            </div>

            <button class="btn-full" onclick="document.getElementById('settings').classList.remove('active')">Close</button>
        </div>
    </div>

    <script type="module">
        // Import Firebase modules directly for internal use
        import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Access initialized instances from window
        const db = window.firebaseModules.db;
        const auth = window.firebaseModules.auth;

        // Main App Logic
        window.app = {
            data: [],
            config: JSON.parse(localStorage.getItem('ql_config') || '{"theme":"light"}'),
            filterKey: 'all', 
            modeKey: 'all',
            searchKey: '',
            isEditing: false,
            user: null,

            init() {
                this.setTheme(this.config.theme);
                document.getElementById('themeSelect').value = this.config.theme;
                
                // Auth Listener
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        this.user = user;
                        this.updateAuthUI(true);
                        this.loadData();
                    } else {
                        this.user = null;
                        this.data = [];
                        this.render();
                        this.updateAuthUI(false);
                    }
                });
            },

            // --- Authentication ---
            openAuthModal() {
                if(this.user) {
                    if(confirm("Logout?")) {
                        signOut(auth).then(() => alert("Logged out"));
                    }
                } else {
                    document.getElementById('authModal').classList.add('active');
                    this.toggleSidebar(false);
                }
            },

            async handleAuth(type) {
                const email = document.getElementById('authEmail').value;
                const pass = document.getElementById('authPass').value;
                if(!email || !pass) return alert("Please enter email and password");

                try {
                    if(type === 'login') {
                        await signInWithEmailAndPassword(auth, email, pass);
                        alert("Login Successful!");
                    } else {
                        await createUserWithEmailAndPassword(auth, email, pass);
                        alert("Account Created & Logged In!");
                    }
                    document.getElementById('authModal').classList.remove('active');
                } catch(error) {
                    alert("Error: " + error.message);
                }
            },

            updateAuthUI(isLoggedIn) {
                const btn = document.getElementById('authBtn');
                if(isLoggedIn) {
                    btn.innerHTML = `<i class="fa-solid fa-right-from-bracket"></i> <span>Logout (${this.user.email.split('@')[0]})</span>`;
                    btn.style.color = "var(--danger)";
                } else {
                    btn.innerHTML = `<i class="fa-solid fa-right-to-bracket"></i> <span>Login</span>`;
                    btn.style.color = "var(--text-sec)";
                }
            },

            // --- Firebase Data Handling ---
            loadData() {
                // Reading from "Link" folder
                const dataRef = ref(db, 'Link'); 
                
                onValue(dataRef, (snapshot) => {
                    this.data = [];
                    const raw = snapshot.val();
                    if(raw) {
                        Object.keys(raw).forEach(key => {
                            this.data.push({ ...raw[key], id: key });
                        });
                        // Sort by date (newest first)
                        this.data.sort((a,b) => new Date(b.date) - new Date(a.date));
                    }
                    this.render();
                });
            },

            save() {
                if(!this.user) return alert("Please Login first to save links!");

                const id = document.getElementById('editId').value;
                const title = document.getElementById('inpTitle').value;
                let url = document.getElementById('inpUrl').value;
                const cat = document.getElementById('inpCat').value;
                const type = document.getElementById('inpType').value; 
                let img = document.getElementById('inpImg').value;    

                if(!title || !url) return alert('Title and URL required');

                if(!url.startsWith('http')) {
                    if(url.includes('t.me') || url.includes('telegram')) url = 'https://' + url;
                    else if(url.includes('wa.me')) url = 'https://' + url;
                    else url = 'https://' + url; 
                }

                if(!img && (url.includes('youtube.com') || url.includes('youtu.be'))) {
                    const vidId = url.split('v=')[1] || url.split('/').pop();
                    if(vidId) img = `https://img.youtube.com/vi/${vidId.split('&')[0]}/mqdefault.jpg`;
                }

                const platform = this.detectPlatform(url);

                const item = {
                    title, url, 
                    category: cat || 'General', 
                    platform, 
                    type: type || 'website',
                    img: img || '',
                    date: new Date().toISOString(),
                    userEmail: this.user.email 
                };

                if(id) {
                    update(ref(db, 'Link/' + id), item)
                        .then(() => this.closeModal())
                        .catch(err => alert(err.message));
                } else {
                    push(ref(db, 'Link'), item)
                        .then(() => this.closeModal())
                        .catch(err => alert(err.message));
                }
            },

            delete(id) {
                if(!this.user) return alert("Login required");
                if(confirm('Delete this link permanently?')) {
                    remove(ref(db, 'Link/' + id));
                }
            },

            edit(id) {
                const i = this.data.find(x => x.id === id);
                document.getElementById('editId').value = i.id;
                document.getElementById('inpTitle').value = i.title;
                document.getElementById('inpUrl').value = i.url;
                document.getElementById('inpCat').value = i.category;
                document.getElementById('inpType').value = i.type || 'website';
                document.getElementById('inpImg').value = i.img || '';
                this.openModal();
            },

            // --- Rendering ---
            render() {
                const grid = document.getElementById('grid');
                grid.innerHTML = '';
                
                const filtered = this.data.filter(i => {
                    const matchPlatform = this.filterKey === 'all' || i.platform === this.filterKey;
                    const matchSearch = i.title.toLowerCase().includes(this.searchKey.toLowerCase());
                    const matchMode = this.modeKey === 'all' || (i.type && i.type === this.modeKey);
                    return matchPlatform && matchSearch && matchMode;
                });

                if(filtered.length === 0) {
                    const msg = this.user ? "No links found" : "Please Login to see links";
                    grid.innerHTML = `<div style="text-align:center; grid-column:1/-1; color:var(--text-sec); padding:40px;">${msg}</div>`;
                    return;
                }

                filtered.forEach(item => {
                    const el = document.createElement('div');
                    el.className = 'card';
                    
                    let iconHtml = '';
                    let iconClass = '';
                    
                    if(item.img) {
                        iconClass = 'has-img';
                        iconHtml = `<img src="${item.img}" onerror="this.style.display='none'">`; 
                    } else {
                        iconClass = this.getIconStyle(item.platform);
                        iconHtml = `<i class="${this.getIconClass(item.platform)}"></i>`;
                    }

                    el.innerHTML = `
                        <div class="c-icon ${iconClass}">
                            ${iconHtml}
                        </div>
                        <div class="c-info">
                            <div class="c-title">${item.title}</div>
                            <div class="c-sub">
                                <span class="c-badge" style="margin-right:4px; opacity:0.7">${item.type || 'link'}</span>
                                <span class="c-badge">${item.category}</span>
                            </div>
                        </div>
                        <div class="c-actions">
                            <a href="${item.url}" target="_blank" class="btn-open action-open">
                                 <i class="fa-solid fa-arrow-up-right-from-square"></i>
                            </a>
                            <button class="btn-action action-edit" onclick="app.edit('${item.id}')">
                                <i class="fa-solid fa-pen"></i>
                            </button>
                            <button class="btn-action btn-del action-edit" onclick="app.delete('${item.id}')">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    `;
                    grid.appendChild(el);
                });
            },

            // --- Helpers ---
            setMode(mode, btn) {
                this.modeKey = mode;
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                if(btn) btn.classList.add('active');
                this.render();
            },

            detectPlatform(url) {
                if(url.includes('t.me') || url.includes('telegram')) return 'telegram';
                if(url.includes('wa.me') || url.includes('whatsapp')) return 'whatsapp';
                if(url.includes('facebook') || url.includes('fb.com')) return 'facebook';
                return 'other';
            },

            getIconClass(p) {
                if(p === 'telegram') return 'fa-brands fa-telegram';
                if(p === 'whatsapp') return 'fa-brands fa-whatsapp';
                if(p === 'facebook') return 'fa-brands fa-facebook';
                return 'fa-solid fa-link';
            },

            getIconStyle(p) {
                if(p === 'telegram') return 'tg';
                if(p === 'whatsapp') return 'wa';
                if(p === 'facebook') return 'fb';
                return 'def';
            },

            toggleSidebar(show) {
                const sb = document.getElementById('sidebar');
                const ov = document.getElementById('sidebarOverlay');
                if(show) { sb.classList.add('show'); ov.classList.add('active'); }
                else { sb.classList.remove('show'); ov.classList.remove('active'); }
            },

            toggleEditMode() {
                this.isEditing = !this.isEditing;
                document.body.classList.toggle('edit-mode');
                const btn = document.getElementById('editToggleBtn');
                if(this.isEditing) btn.classList.add('active-state');
                else btn.classList.remove('active-state');
            },

            filter(key, el) {
                this.filterKey = key;
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                if(el) el.classList.add('active');
                this.render();
                if(window.innerWidth < 769) this.toggleSidebar(false);
            },

            search(val) { this.searchKey = val; this.render(); },
            
            // --- Modal & Settings ---
            openModal() { 
                if(!this.user) return alert("Please Login first!");
                document.getElementById('modal').classList.add('active'); 
                document.getElementById('inpTitle').focus();
            },
            closeModal() { 
                document.getElementById('modal').classList.remove('active'); 
                document.getElementById('editId').value = '';
                document.getElementById('inpTitle').value = '';
                document.getElementById('inpUrl').value = '';
                document.getElementById('inpImg').value = ''; 
            },
            openSettings() { document.getElementById('settings').classList.add('active'); this.toggleSidebar(false); },
            
            setTheme(t) {
                document.body.setAttribute('data-theme', t);
                this.config.theme = t;
                localStorage.setItem('ql_config', JSON.stringify(this.config));
            }
        };

        // Initialize App
        app.init();
    </script>
  <script>
  if ('serviceWorker' in navigator) navigator.serviceWorker.register('service-worker.js');
</script>
</body>
</html>